<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>整形外科 保険請求システム UI モック</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    html, body {
      height: 100%;
    }
    body {
      font-family: "Inter", "Noto Sans JP", sans-serif;
    }
    #bg-canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
    }
    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }
    .glass {
      background: rgba(255, 255, 255, 0.78);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.6);
    }
    .modal {
      display: none;
    }
    .modal.active {
      display: flex;
    }
    .table-sticky th {
      position: sticky;
      top: 0;
      background: rgba(248, 250, 252, 0.9);
      backdrop-filter: blur(10px);
      z-index: 1;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <canvas id="bg-canvas"></canvas>

  <div id="app" class="relative z-10 min-h-screen">
    <header id="app-header" class="hidden fixed top-0 left-0 right-0 z-30">
      <div class="glass shadow-sm">
        <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3 md:px-6">
          <button class="flex items-center gap-2 font-semibold text-slate-900" data-action="go-home">
            <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-slate-900 text-white">整</span>
            <span>整形外科 保険請求システム</span>
          </button>
          <button class="rounded-full border border-slate-200 bg-white/80 p-2 shadow-sm" data-action="open-menu" aria-label="メニュー">
            <i data-lucide="menu" class="h-5 w-5"></i>
          </button>
        </div>
      </div>
    </header>

    <main class="relative z-10 pt-20">
      <section id="screen-loading-pre" class="screen active">
        <div class="mx-auto flex min-h-[70vh] max-w-2xl flex-col items-center justify-center gap-6 px-4 text-center">
          <div class="flex h-16 w-16 items-center justify-center rounded-full border-4 border-slate-200 border-t-slate-900"></div>
          <p class="text-lg font-medium text-slate-700">ローディング中...</p>
        </div>
      </section>

      <section id="screen-login" class="screen">
        <div class="mx-auto flex min-h-[70vh] max-w-3xl flex-col items-center justify-center px-4">
          <div class="glass w-full rounded-3xl p-8 shadow-lg md:p-12">
            <h1 class="text-2xl font-semibold">ログイン</h1>
            <div class="mt-8 grid gap-6">
              <div>
                <label class="text-sm font-medium text-slate-700">ログインID</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" placeholder="例: A000123" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700">パスワード</label>
                <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" placeholder="********" />
              </div>
              <div id="login-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
                ログインIDまたはパスワードの入力エラー
              </div>
              <button class="w-full rounded-xl bg-slate-900 px-4 py-3 text-sm font-semibold text-white" data-action="login">
                ログイン
              </button>
              <button MA-dev class="text-xs text-slate-400" data-action="toggle-login-error">入力エラー表示切替</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-loading-post" class="screen">
        <div class="mx-auto flex min-h-[70vh] max-w-2xl flex-col items-center justify-center gap-6 px-4 text-center">
          <div class="flex h-16 w-16 items-center justify-center rounded-full border-4 border-slate-200 border-t-slate-900"></div>
          <p class="text-lg font-medium text-slate-700">ローディング中...</p>
        </div>
      </section>

      <section id="screen-home" class="screen">
        <div class="mx-auto max-w-5xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">ホーム</h2>
          <div class="mt-6 grid gap-4 md:grid-cols-2">
            <button class="glass rounded-2xl px-5 py-4 text-left" data-action="go-kart-new">
              <p class="text-base font-semibold">カルテ新規入力</p>
            </button>
            <button class="glass rounded-2xl px-5 py-4 text-left" data-action="go-kart-search">
              <p class="text-base font-semibold">カルテ検索</p>
            </button>
            <button class="glass rounded-2xl px-5 py-4 text-left" data-action="go-patient-search">
              <p class="text-base font-semibold">患者マスタ</p>
            </button>
            <div class="glass rounded-2xl px-5 py-4 text-left opacity-50">
              <p class="text-base font-semibold">アカウント作成</p>
              <p class="mt-2 text-xs text-slate-500">権限制限のため使用できません</p>
            </div>
            <button class="glass rounded-2xl px-5 py-4 text-left" data-action="go-history">
              <p class="text-base font-semibold">使用履歴</p>
            </button>
            <button class="glass rounded-2xl px-5 py-4 text-left" data-action="go-login-info">
              <p class="text-base font-semibold">ログイン情報変更</p>
            </button>
            <button class="glass rounded-2xl px-5 py-4 text-left" data-action="go-terms">
              <p class="text-base font-semibold">利用規約</p>
            </button>
            <button class="glass rounded-2xl px-5 py-4 text-left" data-action="logout-confirm">
              <p class="text-base font-semibold">ログアウト</p>
            </button>
          </div>
          <button MA-dev class="mt-4 text-xs text-slate-400" data-action="go-account-create">開発者確認用: アカウント作成画面へ</button>
        </div>
      </section>

      <section id="screen-terms" class="screen">
        <div class="mx-auto max-w-4xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">利用規約</h2>
          <div class="mt-6 rounded-2xl border border-slate-200 bg-white/80 p-6 text-sm leading-7 text-slate-700">
            <p>本システムは保険請求に関するカルテ情報の管理を目的とします。ユーザーは医療機関内の権限に従い、登録情報の適切な管理を行うものとします。</p>
            <p class="mt-4">本システムはグループ単位でのデータ管理を行い、第三者への情報提供は禁止します。</p>
          </div>
          <button class="mt-6 rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
        </div>
      </section>

      <section id="screen-login-info" class="screen">
        <div class="mx-auto max-w-4xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">ログイン情報変更</h2>
          <div class="mt-6 grid gap-5 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div>
              <label class="text-sm font-medium">現在のパスワード</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div>
              <label class="text-sm font-medium">新しいパスワード</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div>
              <label class="text-sm font-medium">新しいパスワード（確認）</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div id="login-info-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
              入力エラー
            </div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="login-info-confirm">変更</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-login-info-error">入力エラー表示切替</button>
          </div>
        </div>
      </section>

      <section id="screen-account-create" class="screen">
        <div class="mx-auto max-w-4xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">アカウント作成</h2>
          <div class="mt-6 grid gap-5 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div>
              <label class="text-sm font-medium">氏名</label>
              <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div>
              <label class="text-sm font-medium">ログインID</label>
              <input type="text" value="A000567" disabled class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-100 px-4 py-3 text-sm text-slate-500" />
            </div>
            <div>
              <label class="text-sm font-medium">パスワード</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div>
              <label class="text-sm font-medium">パスワード（確認）</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div>
              <label class="text-sm font-medium">権限</label>
              <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm">
                <option>管理者</option>
                <option>入力者</option>
                <option>閲覧者</option>
              </select>
            </div>
            <div id="account-create-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="account-create-confirm">登録</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="go-account-search">アカウント検索</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-account-create-error">入力エラー表示切替</button>
          </div>
        </div>
      </section>

      <section id="screen-account-search" class="screen">
        <div class="mx-auto max-w-6xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">アカウント検索</h2>
          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm font-medium">氏名</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">ログインID</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">権限</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>すべて</option>
                  <option>管理者</option>
                  <option>入力者</option>
                  <option>閲覧者</option>
                </select>
              </div>
              <div>
                <label class="text-sm font-medium">並び替え条件</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>作成日（新しい順）</option>
                  <option>更新日（新しい順）</option>
                  <option>氏名</option>
                </select>
              </div>
            </div>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" class="rounded border-slate-300" />
              削除済み含む
            </label>
            <div id="account-search-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">検索条件の入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="account-search">検索</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-account-create">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-account-search-error">検索エラー表示切替</button>
          </div>

          <div class="mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white/80">
            <div class="max-h-[420px] overflow-auto">
              <table class="min-w-full text-left text-sm table-sticky">
                <thead>
                  <tr class="text-slate-500">
                    <th class="px-4 py-3">ログインID</th>
                    <th class="px-4 py-3">氏名</th>
                    <th class="px-4 py-3">権限</th>
                    <th class="px-4 py-3">状態</th>
                    <th class="px-4 py-3">作成日</th>
                    <th class="px-4 py-3">更新日</th>
                  </tr>
                </thead>
                <tbody id="account-table" MA-database class="divide-y divide-slate-200"></tbody>
              </table>
            </div>
            <div class="flex flex-wrap items-center justify-between gap-3 border-t border-slate-200 px-4 py-3">
              <button class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold" data-action="account-next">次の30件を表示</button>
              <span class="text-xs text-slate-500">全件表示用に50件をモックしています</span>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-account-detail" class="screen">
        <div class="mx-auto max-w-4xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">アカウント詳細</h2>
          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6 text-sm">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <p class="text-slate-500">ログインID</p>
                <p class="font-semibold">A000345</p>
              </div>
              <div>
                <p class="text-slate-500">氏名</p>
                <p class="font-semibold">山田 花子</p>
              </div>
              <div>
                <p class="text-slate-500">権限</p>
                <p class="font-semibold">入力者</p>
              </div>
              <div>
                <p class="text-slate-500">状態</p>
                <p class="font-semibold">有効</p>
              </div>
              <div>
                <p class="text-slate-500">作成日</p>
                <p class="font-semibold">2024/04/12</p>
              </div>
              <div>
                <p class="text-slate-500">更新日</p>
                <p class="font-semibold">2024/07/01</p>
              </div>
            </div>
            <div>
              <label class="text-sm font-medium">パスワード変更</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="go-account-edit">編集</button>
              <button class="rounded-xl border border-rose-200 bg-white px-5 py-2 text-sm font-semibold text-rose-600" data-action="account-delete">削除</button>
              <button class="rounded-xl border border-emerald-200 bg-white px-5 py-2 text-sm font-semibold text-emerald-600" data-action="account-revive">復活</button>
              <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="back-account-search">戻る</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-account-edit" class="screen">
        <div class="mx-auto max-w-4xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">アカウント編集</h2>
          <div class="mt-6 grid gap-5 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div>
              <label class="text-sm font-medium">氏名</label>
              <input type="text" value="山田 花子" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div>
              <label class="text-sm font-medium">権限</label>
              <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm">
                <option>管理者</option>
                <option selected>入力者</option>
                <option>閲覧者</option>
              </select>
            </div>
            <div>
              <label class="text-sm font-medium">パスワード</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div>
              <label class="text-sm font-medium">パスワード（確認）</label>
              <input type="password" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div id="account-edit-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="account-edit-confirm">保存</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-account-detail">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-account-edit-error">入力エラー表示切替</button>
          </div>
        </div>
      </section>

      <section id="screen-kart-new" class="screen">
        <div class="mx-auto max-w-6xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">カルテ新規入力</h2>
          <div class="mt-6 flex flex-wrap gap-3">
            <button class="rounded-full px-4 py-2 text-sm font-semibold" data-action="tab-new" id="tab-new-button">新規患者入力</button>
            <button class="rounded-full px-4 py-2 text-sm font-semibold" data-action="tab-master" id="tab-master-button">患者マスタから選択</button>
          </div>

          <div class="mt-6 grid gap-4">
            <div id="new-patient-upload" class="rounded-2xl border border-dashed border-slate-200 bg-slate-50/70 p-6">
              <p class="text-sm font-semibold">手書きカルテのPDF/画像アップロード</p>
              <input type="file" id="kart-upload-file" multiple accept="image/*,application/pdf" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
              <p class="mt-2 text-xs text-slate-500">画像は複数枚選択可能です。PDFは1ファイルのみ対応します。</p>
              <button class="mt-3 inline-flex items-center gap-2 text-xs font-semibold text-slate-600" data-action="toggle-kart-openai-settings">
                <span>ChatGPT設定を開く</span>
                <i data-lucide="chevron-down" class="h-4 w-4"></i>
              </button>
              <div id="kart-openai-settings" class="mt-4 hidden grid gap-3 rounded-xl border border-slate-200 bg-white/80 p-4 text-xs text-slate-500">
                <div>
                  <label class="text-xs font-semibold text-slate-600">ChatGPT APIモデル</label>
                  <input type="text" id="kart-openai-model" value="gpt-5.2" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700" />
                </div>
                <div>
                  <label class="text-xs font-semibold text-slate-600">ChatGPT APIシークレット</label>
                  <input type="password" id="kart-openai-key" placeholder="sk-..." class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700" />
                </div>
                <div>
                  <label class="text-xs font-semibold text-slate-600">送信プロンプト</label>
                  <textarea id="kart-openai-prompt" rows="4" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700">手書きカルテ画像/PDFから読み取れる範囲で、入力フォームに必要な情報を抽出してください。日付はYYYY-MM-DD形式、電話番号はハイフンありのままでも構いません。</textarea>
                  <p class="mt-2 text-[11px] leading-5">対応キー例: patient_id, patient_name, chief_complaint, medical_history, insurance_company, patient_number, copay_rate, public_expense_number, public_expense_beneficiary_number, insurer_number, symbol_number, traffic_accident, valid_until, insured_person, qualification_acquired, furigana, full_name, birth_date, gender, address, phone, occupation, relationship, workplace_address, workplace_phone, workplace_name, insurer_address, insurer_phone, insurer_name, injury_1_name, injury_1_work_type, injury_1_start, injury_1_end, injury_1_outcome ... injury_8_outcome, jiba_statement_year, jiba_statement_month, jiba_treatment_days, jiba_injury_date, jiba_first_visit_date, jiba_treatment_period_from, jiba_treatment_period_to, jiba_outcome, jiba_claim_amount, jiba_10_total_tech_points ... jiba_90_total_note</p>
                </div>
              </div>
              <div id="kart-upload-error" class="hidden mt-3 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">アップロードエラー</div>
              <button id="kart-upload-button" class="mt-4 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold" data-action="kart-upload">手書きカルテをアップロード</button>
            </div>

            <div id="kart-master-panel" class="hidden rounded-2xl border border-slate-200 bg-white/80 p-6">
              <div class="grid gap-4 md:grid-cols-2">
                <div>
                  <label class="text-sm font-medium">患者ID検索</label>
                  <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-sm font-medium">患者名検索</label>
                  <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-sm font-medium">並び替え条件</label>
                  <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                    <option>患者ID</option>
                    <option>患者名</option>
                  </select>
                </div>
              </div>
              <label class="mt-4 flex items-center gap-2 text-sm">
                <input type="checkbox" class="rounded border-slate-300" />
                削除済み含む
              </label>
              <div id="kart-master-search-error" class="hidden mt-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">検索条件の入力エラー</div>
              <div class="mt-4 flex flex-wrap gap-3">
                <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="kart-master-search">検索</button>
                <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
              </div>
              <button MA-dev class="mt-2 text-xs text-slate-400" data-action="toggle-kart-master-search-error">検索エラー表示切替</button>

              <div class="mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white">
                <div class="max-h-[360px] overflow-auto">
                  <table class="min-w-full text-left text-sm table-sticky">
                    <thead>
                      <tr class="text-slate-500">
                        <th class="px-4 py-3">患者ID</th>
                        <th class="px-4 py-3">患者名</th>
                        <th class="px-4 py-3">状態</th>
                      </tr>
                    </thead>
                    <tbody id="kart-master-table" MA-database class="divide-y divide-slate-200"></tbody>
                  </table>
                </div>
                <div class="flex items-center justify-between border-t border-slate-200 px-4 py-3">
                  <button class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold" data-action="kart-master-next">次の30件を表示</button>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm font-medium">カルテID</label>
                <input type="text" value="K-20240715-001" disabled class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-100 px-4 py-3 text-sm text-slate-500" />
              </div>
              <div>
                <label class="text-sm font-medium">患者ID</label>
                <input type="text" id="kart-patient-id" data-kart-field="patient_id" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">患者名</label>
                <input type="text" id="kart-patient-name" data-kart-field="patient_name" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
              </div>
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">主訴</p>
                <input type="text" data-kart-field="chief_complaint" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">既往歴</p>
                <textarea data-kart-field="medical_history" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" rows="3"></textarea>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">保険会社名</p>
                <select data-kart-field="insurance_company" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm">
                  <option>富士保険</option>
                  <option>虹ヶ丘保険</option>
                  <option>朝日保険</option>
                </select>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">画像選択</p>
                <div class="mt-3 grid grid-cols-3 gap-2">
                  <button class="rounded-lg border border-slate-200 p-2 text-xs">X線</button>
                  <button class="rounded-lg border border-slate-200 p-2 text-xs">MRI</button>
                  <button class="rounded-lg border border-slate-200 p-2 text-xs">CT</button>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-white p-6">
              <p class="text-sm font-semibold">診療録追加情報</p>
              <div class="mt-4 grid gap-4 md:grid-cols-2">
                <div>
                  <label class="text-xs font-medium text-slate-500">患者番号</label>
                  <input type="text" data-kart-field="patient_number" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">負担割合</label>
                  <input type="text" data-kart-field="copay_rate" placeholder="例: 0割" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">公費負担番号</label>
                  <input type="text" data-kart-field="public_expense_number" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">公費負担医療の受給者番号</label>
                  <input type="text" data-kart-field="public_expense_beneficiary_number" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">保険者番号</label>
                  <input type="text" data-kart-field="insurer_number" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">記号・番号</label>
                  <input type="text" data-kart-field="symbol_number" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">交通事故</label>
                  <select data-kart-field="traffic_accident" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm">
                    <option>該当なし</option>
                    <option>該当</option>
                  </select>
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">有効期限</label>
                  <input type="date" data-kart-field="valid_until" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">被保険者</label>
                  <input type="text" data-kart-field="insured_person" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">資格取得</label>
                  <input type="date" data-kart-field="qualification_acquired" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">フリガナ</label>
                  <input type="text" data-kart-field="furigana" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">氏名</label>
                  <input type="text" data-kart-field="full_name" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">生年月日</label>
                  <input type="date" data-kart-field="birth_date" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">性別</label>
                  <select data-kart-field="gender" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm">
                    <option>女性</option>
                    <option>男性</option>
                    <option>その他</option>
                  </select>
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">住所</label>
                  <input type="text" data-kart-field="address" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">電話</label>
                  <input type="text" data-kart-field="phone" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">職業</label>
                  <input type="text" data-kart-field="occupation" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">被保険者本人との続柄</label>
                  <input type="text" data-kart-field="relationship" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">事業所所在地</label>
                  <input type="text" data-kart-field="workplace_address" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">事業所電話番号</label>
                  <input type="text" data-kart-field="workplace_phone" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">事業所名称</label>
                  <input type="text" data-kart-field="workplace_name" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">保険者所在地</label>
                  <input type="text" data-kart-field="insurer_address" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">保険者電話番号</label>
                  <input type="text" data-kart-field="insurer_phone" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">保険者名称</label>
                  <input type="text" data-kart-field="insurer_name" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
              </div>
              <div class="mt-6 overflow-hidden rounded-xl border border-slate-200">
                <div class="grid grid-cols-6 bg-slate-50 text-xs font-semibold text-slate-500">
                  <div class="col-span-2 px-3 py-2">傷病名</div>
                  <div class="px-3 py-2">職務</div>
                  <div class="px-3 py-2">開始</div>
                  <div class="px-3 py-2">終了</div>
                  <div class="px-3 py-2">転帰</div>
                </div>
                <div class="divide-y divide-slate-200">
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_1_name" placeholder="傷病名1" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_1_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_1_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_1_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_1_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_2_name" placeholder="傷病名2" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_2_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_2_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_2_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_2_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_3_name" placeholder="傷病名3" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_3_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_3_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_3_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_3_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_4_name" placeholder="傷病名4" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_4_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_4_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_4_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_4_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_5_name" placeholder="傷病名5" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_5_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_5_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_5_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_5_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_6_name" placeholder="傷病名6" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_6_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_6_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_6_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_6_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_7_name" placeholder="傷病名7" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_7_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_7_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_7_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_7_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                  <div class="grid grid-cols-6 gap-2 px-3 py-2">
                    <input type="text" data-kart-field="injury_8_name" placeholder="傷病名8" class="col-span-2 rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_8_work_type" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>上</option>
                      <option>外</option>
                      <option>上・外</option>
                    </select>
                    <input type="date" data-kart-field="injury_8_start" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="date" data-kart-field="injury_8_end" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <select data-kart-field="injury_8_outcome" class="rounded-lg border border-slate-200 px-3 py-2 text-sm">
                      <option>治癒</option>
                      <option>中止</option>
                      <option>継続</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-white p-6">
              <p class="text-sm font-semibold">自賠責診療報酬明細書（入院）</p>
              <div class="mt-4 grid gap-4 md:grid-cols-3">
                <div>
                  <label class="text-xs font-medium text-slate-500">年</label>
                  <input type="text" data-kart-field="jiba_statement_year" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" placeholder="例: 2024" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">月</label>
                  <input type="text" data-kart-field="jiba_statement_month" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" placeholder="例: 7" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">診療実日数</label>
                  <input type="text" data-kart-field="jiba_treatment_days" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">受傷日</label>
                  <input type="date" data-kart-field="jiba_injury_date" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">初診日</label>
                  <input type="date" data-kart-field="jiba_first_visit_date" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">診療開始日</label>
                  <input type="date" data-kart-field="jiba_treatment_start_date" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">診療期間（自）</label>
                  <input type="date" data-kart-field="jiba_treatment_period_from" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">診療期間（至）</label>
                  <input type="date" data-kart-field="jiba_treatment_period_to" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">転帰</label>
                  <select data-kart-field="jiba_outcome" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm">
                    <option>治癒</option>
                    <option>継続</option>
                    <option>転医</option>
                    <option>中止</option>
                    <option>死亡</option>
                  </select>
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">年齢</label>
                  <input type="text" data-kart-field="jiba_age" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
              </div>

              <div class="mt-6 overflow-hidden rounded-xl border border-slate-200">
                <div class="grid grid-cols-5 bg-slate-50 text-xs font-semibold text-slate-500">
                  <div class="px-3 py-2">診療内容</div>
                  <div class="px-3 py-2">技術点数</div>
                  <div class="px-3 py-2">薬剤・器材点数</div>
                  <div class="px-3 py-2">金額</div>
                  <div class="px-3 py-2">摘要</div>
                </div>
                <div class="divide-y divide-slate-200 text-sm">
                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">10 診察（小計）</div>
                    <input type="text" data-kart-field="jiba_10_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_10_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_10_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_10_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="11 初診" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_11_initial_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_11_initial_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_11_initial_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_11_initial_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="12 再診" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_12_followup_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_12_followup_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_12_followup_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_12_followup_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="13 医学管理" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_13_management_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_13_management_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_13_management_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_13_management_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="14 時間外" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_14_after_hours_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_14_after_hours_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_14_after_hours_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_14_after_hours_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="15 休日" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_15_holiday_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_15_holiday_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_15_holiday_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_15_holiday_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="16 深夜" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_16_midnight_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_16_midnight_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_16_midnight_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_16_midnight_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="救急医療管理加算" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_emergency_management_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_emergency_management_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_emergency_management_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_emergency_management_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">20 投薬（小計）</div>
                    <input type="text" data-kart-field="jiba_20_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_20_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_20_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_20_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="21 内服" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_21_oral_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_21_oral_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_21_oral_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_21_oral_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="22 頓服" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_22_prn_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_22_prn_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_22_prn_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_22_prn_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="23 外用" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_23_topical_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_23_topical_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_23_topical_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_23_topical_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="24 調剤" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_24_dispense_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_24_dispense_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_24_dispense_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_24_dispense_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">30 注射（小計）</div>
                    <input type="text" data-kart-field="jiba_30_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_30_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_30_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_30_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="31 皮下・筋肉内" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_31_subcutaneous_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_31_subcutaneous_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_31_subcutaneous_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_31_subcutaneous_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="32 静脈内" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_32_intravenous_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_32_intravenous_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_32_intravenous_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_32_intravenous_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="33 その他" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_33_injection_other_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_33_injection_other_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_33_injection_other_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_33_injection_other_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">40 処置（小計）</div>
                    <input type="text" data-kart-field="jiba_40_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_40_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_40_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_40_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="41 処置1" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_41_procedure_1_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_41_procedure_1_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_41_procedure_1_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_41_procedure_1_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="42 処置2" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_42_procedure_2_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_42_procedure_2_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_42_procedure_2_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_42_procedure_2_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">50 手術（小計）</div>
                    <input type="text" data-kart-field="jiba_50_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_50_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_50_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_50_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="51 手術1" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_51_surgery_1_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_51_surgery_1_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_51_surgery_1_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_51_surgery_1_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">60 麻酔（小計）</div>
                    <input type="text" data-kart-field="jiba_60_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_60_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_60_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_60_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="61 麻酔1" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_61_anesthesia_1_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_61_anesthesia_1_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_61_anesthesia_1_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_61_anesthesia_1_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">70 検査（小計）</div>
                    <input type="text" data-kart-field="jiba_70_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_70_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_70_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_70_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="71 検査1" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_71_test_1_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_71_test_1_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_71_test_1_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_71_test_1_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">80 画像・その他（小計）</div>
                    <input type="text" data-kart-field="jiba_80_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_80_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_80_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_80_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="81 画像診断" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_81_imaging_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_81_imaging_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_81_imaging_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_81_imaging_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="82 フィルム・薬剤等" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_82_film_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_82_film_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_82_film_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_82_film_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="83 リハビリテーション" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_83_rehab_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_83_rehab_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_83_rehab_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_83_rehab_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>

                  <div class="grid grid-cols-5 gap-2 bg-slate-50/70 px-3 py-2 font-semibold">
                    <div class="col-span-1">90 入院（小計）</div>
                    <input type="text" data-kart-field="jiba_90_total_tech_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_90_total_drug_points" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_90_total_amount" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                    <input type="text" data-kart-field="jiba_90_total_note" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-normal" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="91 入院基本料" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_91_hospital_basic_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_91_hospital_basic_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_91_hospital_basic_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_91_hospital_basic_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                  <div class="grid grid-cols-5 gap-2 px-3 py-2">
                    <input type="text" value="92 入院料加算" readonly class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_92_hospital_addon_tech_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_92_hospital_addon_drug_points" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_92_hospital_addon_amount" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_92_hospital_addon_note" class="rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                  </div>
                </div>
              </div>

              <div class="mt-6 grid gap-4 md:grid-cols-3">
                <div>
                  <label class="text-xs font-medium text-slate-500">10〜90点数計</label>
                  <input type="text" data-kart-field="jiba_points_total_10_90" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">請求額（合計）</label>
                  <input type="text" data-kart-field="jiba_claim_amount" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
              </div>

              <div class="mt-6 rounded-xl border border-slate-200 bg-slate-50 p-4">
                <p class="text-xs font-semibold text-slate-600">請求額の計算</p>
                <div class="mt-3 grid gap-3 md:grid-cols-5">
                  <div>
                    <label class="text-[11px] text-slate-500">A</label>
                    <input type="text" data-kart-field="jiba_claim_calc_a" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs" />
                  </div>
                  <div>
                    <label class="text-[11px] text-slate-500">B</label>
                    <input type="text" data-kart-field="jiba_claim_calc_b" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs" />
                  </div>
                  <div>
                    <label class="text-[11px] text-slate-500">C</label>
                    <input type="text" data-kart-field="jiba_claim_calc_c" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs" />
                  </div>
                  <div>
                    <label class="text-[11px] text-slate-500">D</label>
                    <input type="text" data-kart-field="jiba_claim_calc_d" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs" />
                  </div>
                  <div>
                    <label class="text-[11px] text-slate-500">合計</label>
                    <input type="text" data-kart-field="jiba_claim_calc_total" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs" />
                  </div>
                </div>
              </div>

              <div class="mt-6 grid gap-4 md:grid-cols-2">
                <div>
                  <label class="text-xs font-medium text-slate-500">請求日（年）</label>
                  <input type="text" data-kart-field="jiba_claim_year" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">請求日（月/日）</label>
                  <div class="mt-2 grid grid-cols-2 gap-2">
                    <input type="text" data-kart-field="jiba_claim_month" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                    <input type="text" data-kart-field="jiba_claim_day" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                  </div>
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">所在地</label>
                  <input type="text" data-kart-field="jiba_institution_address" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">名称</label>
                  <input type="text" data-kart-field="jiba_institution_name" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">医師名</label>
                  <input type="text" data-kart-field="jiba_doctor_name" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">電話</label>
                  <input type="text" data-kart-field="jiba_institution_phone" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">病床数</label>
                  <input type="text" data-kart-field="jiba_bed_count" class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" />
                </div>
              </div>
            </div>

            <div id="kart-input-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">入力エラー</div>

            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="kart-register">登録</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="kart-reset">入力内容をリセット</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
            </div>
            <div class="flex flex-wrap gap-4 text-xs text-slate-400">
              <button MA-dev data-action="toggle-kart-input-error">入力エラー表示切替</button>
              <button MA-dev data-action="toggle-kart-upload-error">アップロードエラー表示切替</button>
            </div>
          </div>

        </div>
      </section>

      <section id="screen-kart-search" class="screen">
        <div class="mx-auto max-w-6xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">カルテ検索</h2>
          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-3">
              <div>
                <label class="text-sm font-medium">カルテID</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">患者ID</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">患者名</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">保険会社名</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">保険項目</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">作成日</label>
                <input type="date" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">並び替え条件</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>作成日（新しい順）</option>
                  <option>更新日（新しい順）</option>
                </select>
              </div>
            </div>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" class="rounded border-slate-300" />
              削除済み含む
            </label>
            <div id="kart-search-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">検索条件の入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="kart-search">検索</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-kart-search-error">検索エラー表示切替</button>
          </div>

          <div class="mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white/80">
            <div class="max-h-[420px] overflow-auto">
              <table class="min-w-full text-left text-sm table-sticky">
                <thead>
                  <tr class="text-slate-500">
                    <th class="px-4 py-3">カルテID</th>
                    <th class="px-4 py-3">患者ID</th>
                    <th class="px-4 py-3">患者名</th>
                    <th class="px-4 py-3">保険会社名</th>
                    <th class="px-4 py-3">保険項目</th>
                    <th class="px-4 py-3">状態</th>
                    <th class="px-4 py-3">作成日</th>
                    <th class="px-4 py-3">更新日</th>
                  </tr>
                </thead>
                <tbody id="kart-table" MA-database class="divide-y divide-slate-200"></tbody>
              </table>
            </div>
            <div class="flex items-center justify-between border-t border-slate-200 px-4 py-3">
              <button class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold" data-action="kart-next">次の30件を表示</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-kart-detail" class="screen">
        <div class="mx-auto max-w-5xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">カルテ詳細</h2>
          <div class="mt-6 grid gap-6 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-2 text-sm">
              <div>
                <p class="text-slate-500">カルテID</p>
                <p class="font-semibold">K-20240702-002</p>
              </div>
              <div>
                <p class="text-slate-500">患者ID</p>
                <p class="font-semibold">P-1023</p>
              </div>
              <div>
                <p class="text-slate-500">患者名</p>
                <p class="font-semibold">青木 次郎</p>
              </div>
              <div>
                <p class="text-slate-500">保険会社名</p>
                <p class="font-semibold">虹ヶ丘保険</p>
              </div>
              <div>
                <p class="text-slate-500">保険項目</p>
                <p class="font-semibold">スポーツ外傷</p>
              </div>
            </div>
            <div class="grid gap-4 md:grid-cols-2">
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">主訴</p>
                <p class="mt-3 text-sm text-slate-600">膝の痛みが続いている</p>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">既往歴</p>
                <p class="mt-3 text-sm text-slate-600">2020年に靭帯損傷あり</p>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">診断メモ</p>
                <p class="mt-3 text-sm text-slate-600">腫脹があり、MRI確認予定</p>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">処置内容</p>
                <p class="mt-3 text-sm text-slate-600">固定具装着、安静指示</p>
              </div>
            </div>
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <p class="text-sm font-semibold">登録された画像のサムネイル</p>
                <div class="mt-3 grid grid-cols-2 gap-3">
                  <img src="https://images.unsplash.com/photo-1580281657527-47f249e8f8e4?auto=format&fit=crop&w=300&q=80" alt="サムネイル" class="h-24 w-full rounded-xl object-cover" />
                  <img src="https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?auto=format&fit=crop&w=300&q=80" alt="サムネイル" class="h-24 w-full rounded-xl object-cover" />
                </div>
              </div>
              <div>
                <p class="text-sm font-semibold">登録された画像の表示領域</p>
                <img src="https://images.unsplash.com/photo-1580281658629-2c1ab86d7c0c?auto=format&fit=crop&w=600&q=80" alt="画像表示" class="mt-3 h-40 w-full rounded-2xl object-cover" />
              </div>
            </div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="go-kart-edit">編集</button>
              <button class="rounded-xl border border-rose-200 bg-white px-5 py-2 text-sm font-semibold text-rose-600" data-action="kart-delete">削除</button>
              <button class="rounded-xl border border-emerald-200 bg-white px-5 py-2 text-sm font-semibold text-emerald-600" data-action="kart-revive">復活</button>
              <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="go-insurance-download">保険請求書類ダウンロード</button>
              <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="back-kart-search">戻る</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-kart-edit" class="screen">
        <div class="mx-auto max-w-5xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">カルテ編集</h2>
          <div class="mt-6 grid gap-5 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div>
              <label class="text-sm font-medium">患者ID</label>
              <input type="text" value="P-1023" disabled class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-100 px-4 py-3 text-sm text-slate-500" />
            </div>
            <div>
              <label class="text-sm font-medium">患者名</label>
              <input type="text" value="青木 次郎" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div class="grid gap-4 md:grid-cols-2">
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">主訴</p>
                <input type="text" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" value="膝の痛み" />
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">既往歴</p>
                <textarea class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" rows="3">2020年靭帯損傷</textarea>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">保険会社名</p>
                <select class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm">
                  <option>富士保険</option>
                  <option selected>虹ヶ丘保険</option>
                  <option>朝日保険</option>
                </select>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">画像選択</p>
                <div class="mt-3 grid grid-cols-3 gap-2">
                  <button class="rounded-lg border border-slate-200 p-2 text-xs">X線</button>
                  <button class="rounded-lg border border-slate-200 p-2 text-xs">MRI</button>
                  <button class="rounded-lg border border-slate-200 p-2 text-xs">CT</button>
                </div>
              </div>
            </div>
            <div id="kart-edit-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="kart-edit-confirm">保存</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-kart-detail">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-kart-edit-error">入力エラー表示切替</button>
          </div>
        </div>
      </section>

      <section id="screen-insurance-download" class="screen">
        <div class="mx-auto max-w-6xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">保険請求書類ダウンロード</h2>
          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm font-medium">会社名</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">文書様式</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">保険項目</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">並び替え条件</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>会社名</option>
                  <option>文書様式</option>
                </select>
              </div>
            </div>
            <div id="download-search-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">検索条件の入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="download-search">検索</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-kart-detail">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-download-search-error">検索エラー表示切替</button>
          </div>

          <div class="mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white/80">
            <div class="max-h-[420px] overflow-auto">
              <table class="min-w-full text-left text-sm table-sticky">
                <thead>
                  <tr class="text-slate-500">
                    <th class="px-4 py-3">会社名</th>
                    <th class="px-4 py-3">文書様式名</th>
                    <th class="px-4 py-3">保険項目</th>
                  </tr>
                </thead>
                <tbody id="download-table" MA-database class="divide-y divide-slate-200"></tbody>
              </table>
            </div>
            <div class="flex items-center justify-between border-t border-slate-200 px-4 py-3">
              <button class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold" data-action="download-next">次の30件を表示</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-patient-search" class="screen">
        <div class="mx-auto max-w-6xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">患者マスタ検索</h2>
          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm font-medium">患者ID</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">患者名</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">並び替え条件</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>患者ID</option>
                  <option>患者名</option>
                </select>
              </div>
            </div>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" class="rounded border-slate-300" />
              削除済み含む
            </label>
            <div id="patient-search-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">検索条件の入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="patient-search">検索</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-patient-search-error">検索エラー表示切替</button>
          </div>

          <div class="mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white/80">
            <div class="max-h-[420px] overflow-auto">
              <table class="min-w-full text-left text-sm table-sticky">
                <thead>
                  <tr class="text-slate-500">
                    <th class="px-4 py-3">患者ID</th>
                    <th class="px-4 py-3">患者名</th>
                    <th class="px-4 py-3">状態</th>
                    <th class="px-4 py-3">作成日</th>
                    <th class="px-4 py-3">更新日</th>
                  </tr>
                </thead>
                <tbody id="patient-table" MA-database class="divide-y divide-slate-200"></tbody>
              </table>
            </div>
            <div class="flex items-center justify-between border-t border-slate-200 px-4 py-3">
              <button class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold" data-action="patient-next">次の30件を表示</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-patient-detail" class="screen">
        <div class="mx-auto max-w-5xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">患者マスタ詳細</h2>
          <div class="mt-6 grid gap-6 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-2 text-sm">
              <div>
                <p class="text-slate-500">患者ID</p>
                <p class="font-semibold">P-1201</p>
              </div>
              <div>
                <p class="text-slate-500">患者名</p>
                <p class="font-semibold">佐藤 遥</p>
              </div>
              <div>
                <p class="text-slate-500">状態</p>
                <p class="font-semibold">有効</p>
              </div>
              <div>
                <p class="text-slate-500">作成日</p>
                <p class="font-semibold">2024/06/11</p>
              </div>
              <div>
                <p class="text-slate-500">更新日</p>
                <p class="font-semibold">2024/07/05</p>
              </div>
            </div>
            <div class="grid gap-4 md:grid-cols-2">
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">住所</p>
                <p class="mt-3 text-sm text-slate-600">東京都新宿区西新宿</p>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">電話番号</p>
                <p class="mt-3 text-sm text-slate-600">03-1234-5678</p>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">保険証番号</p>
                <p class="mt-3 text-sm text-slate-600">H-778892</p>
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">連絡先メモ</p>
                <p class="mt-3 text-sm text-slate-600">日中連絡可</p>
              </div>
            </div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="go-patient-edit">編集</button>
              <button class="rounded-xl border border-rose-200 bg-white px-5 py-2 text-sm font-semibold text-rose-600" data-action="patient-delete">削除</button>
              <button class="rounded-xl border border-emerald-200 bg-white px-5 py-2 text-sm font-semibold text-emerald-600" data-action="patient-revive">復活</button>
              <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="back-patient-search">戻る</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-patient-edit" class="screen">
        <div class="mx-auto max-w-5xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">患者マスタ編集</h2>
          <div class="mt-6 grid gap-5 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div>
              <label class="text-sm font-medium">患者ID</label>
              <input type="text" value="P-1201" disabled class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-100 px-4 py-3 text-sm text-slate-500" />
            </div>
            <div>
              <label class="text-sm font-medium">患者名</label>
              <input type="text" value="佐藤 遥" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm" />
            </div>
            <div class="grid gap-4 md:grid-cols-2">
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">住所</p>
                <input type="text" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" value="東京都新宿区西新宿" />
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">電話番号</p>
                <input type="text" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" value="03-1234-5678" />
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">保険証番号</p>
                <input type="text" class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" value="H-778892" />
              </div>
              <div class="rounded-xl border border-slate-200 bg-white p-4">
                <p class="text-sm font-semibold">連絡先メモ</p>
                <textarea class="mt-3 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm" rows="3">日中連絡可</textarea>
              </div>
            </div>
            <div id="patient-edit-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="patient-edit-confirm">保存</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-patient-detail">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-patient-edit-error">入力エラー表示切替</button>
          </div>
        </div>
      </section>

      <section id="screen-history" class="screen">
        <div class="mx-auto max-w-6xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">使用履歴検索</h2>
          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6">
            <div class="grid gap-4 md:grid-cols-3">
              <div>
                <label class="text-sm font-medium">アカウント名</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">ログインID</label>
                <input type="text" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">操作種別</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>すべて</option>
                  <option>作成</option>
                  <option>編集</option>
                  <option>削除</option>
                  <option>ダウンロード</option>
                </select>
              </div>
              <div>
                <label class="text-sm font-medium">対象種別</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>すべて</option>
                  <option>カルテ</option>
                  <option>患者</option>
                  <option>アカウント</option>
                </select>
              </div>
              <div>
                <label class="text-sm font-medium">操作日</label>
                <input type="date" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
              </div>
              <div>
                <label class="text-sm font-medium">並び替え条件</label>
                <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
                  <option>操作日時（新しい順）</option>
                  <option>アカウント名</option>
                </select>
              </div>
            </div>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" class="rounded border-slate-300" />
              削除済み含む
            </label>
            <div id="history-search-error" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">検索条件の入力エラー</div>
            <div class="flex flex-wrap gap-3">
              <button class="rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold text-white" data-action="history-search">検索</button>
              <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-home">戻る</button>
            </div>
            <button MA-dev class="text-xs text-slate-400" data-action="toggle-history-search-error">検索エラー表示切替</button>
          </div>

          <div class="mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white/80">
            <div class="max-h-[420px] overflow-auto">
              <table class="min-w-full text-left text-sm table-sticky">
                <thead>
                  <tr class="text-slate-500">
                    <th class="px-4 py-3">操作日時</th>
                    <th class="px-4 py-3">アカウント名</th>
                    <th class="px-4 py-3">ログインID</th>
                    <th class="px-4 py-3">操作種別</th>
                    <th class="px-4 py-3">対象種別</th>
                    <th class="px-4 py-3">対象ID</th>
                    <th class="px-4 py-3">概要</th>
                  </tr>
                </thead>
                <tbody id="history-table" MA-database class="divide-y divide-slate-200"></tbody>
              </table>
            </div>
            <div class="flex items-center justify-between border-t border-slate-200 px-4 py-3">
              <button class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold" data-action="history-next">次の30件を表示</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-history-detail" class="screen">
        <div class="mx-auto max-w-4xl px-4 pb-16 md:px-6">
          <h2 class="text-2xl font-semibold">使用履歴詳細</h2>
          <div class="mt-6 grid gap-4 rounded-2xl border border-slate-200 bg-white/80 p-6 text-sm">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <p class="text-slate-500">操作日時</p>
                <p class="font-semibold">2024/07/15 10:45</p>
              </div>
              <div>
                <p class="text-slate-500">アカウント名</p>
                <p class="font-semibold">山田 花子</p>
              </div>
              <div>
                <p class="text-slate-500">ログインID</p>
                <p class="font-semibold">A000345</p>
              </div>
              <div>
                <p class="text-slate-500">操作種別</p>
                <p class="font-semibold">ダウンロード</p>
              </div>
              <div>
                <p class="text-slate-500">対象種別</p>
                <p class="font-semibold">カルテ</p>
              </div>
              <div>
                <p class="text-slate-500">対象ID</p>
                <p class="font-semibold">K-20240702-002</p>
              </div>
            </div>
            <div>
              <p class="text-slate-500">詳細内容</p>
              <p class="mt-2 text-sm text-slate-700">保険請求書類「虹ヶ丘保険/外傷用」ダウンロード</p>
            </div>
            <button class="rounded-xl border border-slate-200 bg-white px-6 py-3 text-sm font-semibold" data-action="back-history">戻る</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="menu-overlay" class="fixed inset-0 z-40 hidden items-center justify-center bg-slate-900/60">
    <div class="glass w-[90%] max-w-md rounded-3xl p-6">
      <div class="flex items-center justify-between">
        <p class="text-lg font-semibold">メニュー</p>
        <button class="rounded-full border border-slate-200 bg-white/80 p-2" data-action="close-menu" aria-label="閉じる">
          <i data-lucide="x" class="h-5 w-5"></i>
        </button>
      </div>
      <div class="mt-6 grid gap-3 text-sm">
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="go-kart-new">カルテ新規入力</button>
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="go-kart-search">カルテ検索</button>
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="go-patient-search">患者マスタ</button>
        <div class="rounded-xl border border-slate-200 bg-white px-4 py-3 text-left opacity-50">
          アカウント作成
          <p class="mt-2 text-xs text-slate-400">権限制限のため使用できません</p>
        </div>
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="go-history">使用履歴</button>
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="go-login-info">ログイン情報変更</button>
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="go-terms">利用規約</button>
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="logout-confirm">ログアウト</button>
        <button class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-left" data-action="close-menu">閉じる</button>
      </div>
    </div>
  </div>

  <div id="modal-logout" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">ログアウトしますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="logout-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="logout-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-logout-loading" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full border-4 border-slate-200 border-t-slate-900"></div>
      <p class="mt-4 text-sm text-slate-700">ログアウト処理中...</p>
    </div>
  </div>

  <div id="modal-login-info-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">変更を確定しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="login-info-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="login-info-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-login-info-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">パスワード変更が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="login-info-ok">OK</button>
    </div>
  </div>

  <div id="modal-account-create-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">アカウントを登録しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="account-create-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="account-create-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-account-create-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">登録が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="account-create-ok">OK</button>
    </div>
  </div>

  <div id="modal-account-edit-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">保存しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="account-edit-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="account-edit-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-account-edit-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">保存が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="account-edit-ok">OK</button>
    </div>
  </div>

  <div id="modal-account-delete-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">削除しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="account-delete-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="account-delete-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-account-delete-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">削除が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="account-delete-ok">OK</button>
    </div>
  </div>

  <div id="modal-account-revive-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">復活しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="account-revive-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="account-revive-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-account-revive-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">復活が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="account-revive-ok">OK</button>
    </div>
  </div>

  <div id="modal-kart-register-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">カルテを登録しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="kart-register-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="kart-register-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-kart-register-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">登録が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="kart-register-ok">OK</button>
    </div>
  </div>

  <div id="modal-kart-edit-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">保存しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="kart-edit-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="kart-edit-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-kart-edit-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">保存が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="kart-edit-ok">OK</button>
    </div>
  </div>

  <div id="modal-kart-delete-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">削除しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="kart-delete-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="kart-delete-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-kart-delete-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">削除が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="kart-delete-ok">OK</button>
    </div>
  </div>

  <div id="modal-kart-revive-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">復活しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="kart-revive-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="kart-revive-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-kart-revive-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">復活が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="kart-revive-ok">OK</button>
    </div>
  </div>

  <div id="modal-print-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">印刷ダイアログを開きますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="print-confirm-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="print-confirm-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-print" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-lg rounded-2xl p-6">
      <p class="text-lg font-semibold">印刷</p>
      <p class="mt-2 text-sm text-slate-600">PDFとしてダウンロード可能</p>
      <div class="mt-4 grid gap-4 md:grid-cols-2 text-sm">
        <div>
          <label class="text-sm font-medium">プリンタ選択</label>
          <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm">
            <option>PDF</option>
            <option>プリンタA</option>
          </select>
        </div>
        <div>
          <label class="text-sm font-medium">印刷部数</label>
          <input type="number" value="1" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm" />
        </div>
      </div>
      <div class="mt-4 rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm">
        <p class="font-medium text-slate-700">印刷設定</p>
        <div class="mt-3 grid gap-2 text-xs text-slate-600">
          <label class="flex items-center gap-2"><input type="checkbox" checked /> カラー印刷</label>
          <label class="flex items-center gap-2"><input type="checkbox" /> 両面印刷</label>
          <label class="flex items-center gap-2"><input type="checkbox" checked /> 余白を最小化</label>
        </div>
      </div>
      <div class="mt-6 flex justify-end gap-3">
        <button class="rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="print-exec">印刷実行</button>
        <button class="rounded-xl border border-slate-200 bg-white px-6 py-2 text-sm font-semibold" data-action="print-cancel">キャンセル</button>
      </div>
    </div>
  </div>

  <div id="modal-patient-edit-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">保存しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="patient-edit-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="patient-edit-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-patient-edit-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">保存が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="patient-edit-ok">OK</button>
    </div>
  </div>

  <div id="modal-patient-delete-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">削除しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="patient-delete-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="patient-delete-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-patient-delete-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">削除が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="patient-delete-ok">OK</button>
    </div>
  </div>

  <div id="modal-patient-revive-confirm" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">復活しますか？</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="patient-revive-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="patient-revive-no">いいえ</button>
      </div>
    </div>
  </div>

  <div id="modal-patient-revive-done" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">復活が完了しました</p>
      <button class="mt-6 rounded-xl bg-slate-900 px-6 py-2 text-sm font-semibold text-white" data-action="patient-revive-ok">OK</button>
    </div>
  </div>

  <div id="modal-history-detail" class="modal fixed inset-0 z-50 items-center justify-center bg-slate-900/50">
    <div class="glass w-[90%] max-w-sm rounded-2xl p-6 text-center">
      <p class="text-lg font-semibold">詳細画面へ移動します</p>
      <div class="mt-6 flex justify-center gap-3">
        <button class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white" data-action="history-detail-yes">はい</button>
        <button class="rounded-xl border border-slate-200 bg-white px-5 py-2 text-sm font-semibold" data-action="history-detail-no">いいえ</button>
      </div>
    </div>
  </div>

  <script>
    const screens = Array.from(document.querySelectorAll('.screen'));
    const header = document.getElementById('app-header');
    const menuOverlay = document.getElementById('menu-overlay');
    const modals = document.querySelectorAll('.modal');

    const showScreen = (id, loggedIn = true) => {
      screens.forEach(screen => screen.classList.remove('active'));
      const target = document.getElementById(id);
      if (target) {
        target.classList.add('active');
      }
      header.classList.toggle('hidden', !loggedIn);
      window.scrollTo({ top: 0, behavior: 'instant' });
    };

    const closeModals = () => {
      modals.forEach(modal => modal.classList.remove('active'));
    };

    const openModal = (id) => {
      closeModals();
      const modal = document.getElementById(id);
      if (modal) modal.classList.add('active');
    };

    const toggleElement = (id) => {
      const el = document.getElementById(id);
      if (el) el.classList.toggle('hidden');
    };

    const setTab = (tab) => {
      const newButton = document.getElementById('tab-new-button');
      const masterButton = document.getElementById('tab-master-button');
      const masterPanel = document.getElementById('kart-master-panel');
      const uploadPanel = document.getElementById('new-patient-upload');
      if (tab === 'new') {
        newButton.classList.add('bg-slate-900', 'text-white');
        masterButton.classList.remove('bg-slate-900', 'text-white');
        masterPanel.classList.add('hidden');
        uploadPanel.classList.remove('hidden');
      } else {
        masterButton.classList.add('bg-slate-900', 'text-white');
        newButton.classList.remove('bg-slate-900', 'text-white');
        masterPanel.classList.remove('hidden');
        uploadPanel.classList.add('hidden');
        document.getElementById('kart-patient-id').value = 'P-1201';
        document.getElementById('kart-patient-name').value = '佐藤 遥';
        document.getElementById('kart-patient-id').setAttribute('disabled', 'true');
        document.getElementById('kart-patient-name').setAttribute('disabled', 'true');
        document.getElementById('kart-patient-id').classList.add('bg-slate-100');
        document.getElementById('kart-patient-name').classList.add('bg-slate-100');
      }
    };

    const setNewPatientEditable = () => {
      document.getElementById('kart-patient-id').removeAttribute('disabled');
      document.getElementById('kart-patient-name').removeAttribute('disabled');
      document.getElementById('kart-patient-id').classList.remove('bg-slate-100');
      document.getElementById('kart-patient-name').classList.remove('bg-slate-100');
    };

    const kartAutofillFields = Array.from(document.querySelectorAll('[data-kart-field]'))
      .reduce((acc, el) => {
        acc[el.dataset.kartField] = el;
        return acc;
      }, {});
    const kartAutofillKeys = Object.keys(kartAutofillFields);
    const kartUploadInput = document.getElementById('kart-upload-file');
    const kartUploadButton = document.getElementById('kart-upload-button');
    const kartUploadError = document.getElementById('kart-upload-error');
    const kartApiKeyInput = document.getElementById('kart-openai-key');
    const kartModelInput = document.getElementById('kart-openai-model');
    const kartPromptInput = document.getElementById('kart-openai-prompt');
    const kartOpenAiSettings = document.getElementById('kart-openai-settings');
    const kartOpenAiToggle = document.querySelector('[data-action="toggle-kart-openai-settings"]');
    const kartOpenAiToggleText = kartOpenAiToggle?.querySelector('span');
    const kartOpenAiToggleIcon = kartOpenAiToggle?.querySelector('i');
    const kartDefaultValues = Object.fromEntries(
      Array.from(document.querySelectorAll('[data-kart-field]')).map((el) => [el.dataset.kartField, el.value])
    );
    const kartOpenAiDefaults = {
      model: kartModelInput?.value ?? '',
      key: kartApiKeyInput?.value ?? '',
      prompt: kartPromptInput?.value ?? ''
    };

    if (window.pdfjsLib) {
      window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }

    const setKartUploadStatus = (message, isError = false) => {
      if (!kartUploadError) return;
      if (!message) {
        kartUploadError.classList.add('hidden');
        return;
      }
      kartUploadError.textContent = message;
      kartUploadError.classList.toggle('bg-rose-50', isError);
      kartUploadError.classList.toggle('border-rose-200', isError);
      kartUploadError.classList.toggle('text-rose-700', isError);
      kartUploadError.classList.toggle('bg-emerald-50', !isError);
      kartUploadError.classList.toggle('border-emerald-200', !isError);
      kartUploadError.classList.toggle('text-emerald-700', !isError);
      kartUploadError.classList.remove('hidden');
    };

    const readFileAsDataUrl = (file) => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject(new Error('ファイルの読み込みに失敗しました。'));
      reader.readAsDataURL(file);
    });

    const readPdfAsImages = async (file) => {
      if (!window.pdfjsLib) {
        throw new Error('PDF解析ライブラリが読み込まれていません。');
      }
      const data = await file.arrayBuffer();
      const pdf = await window.pdfjsLib.getDocument({ data }).promise;
      const images = [];
      for (let pageNumber = 1; pageNumber <= pdf.numPages; pageNumber += 1) {
        const page = await pdf.getPage(pageNumber);
        const viewport = page.getViewport({ scale: 2 });
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        await page.render({ canvasContext: context, viewport }).promise;
        images.push(canvas.toDataURL('image/png'));
      }
      return images;
    };

    const extractJson = (text) => {
      if (!text) return null;
      try {
        return JSON.parse(text);
      } catch (error) {
        const fenced = text.match(/```json\s*([\s\S]*?)```/i);
        if (fenced?.[1]) {
          try {
            return JSON.parse(fenced[1]);
          } catch (jsonError) {
            return null;
          }
        }
        const firstBrace = text.indexOf('{');
        const lastBrace = text.lastIndexOf('}');
        if (firstBrace !== -1 && lastBrace !== -1 && lastBrace > firstBrace) {
          try {
            return JSON.parse(text.slice(firstBrace, lastBrace + 1));
          } catch (jsonError) {
            return null;
          }
        }
      }
      return null;
    };

    const setSelectValue = (select, value) => {
      const normalized = String(value).trim();
      const option = Array.from(select.options).find(
        (opt) => opt.value === normalized || opt.text === normalized
      );
      if (option) {
        select.value = option.value;
      } else if (normalized) {
        const fallbackOption = new Option(normalized, normalized);
        select.add(fallbackOption);
        select.value = normalized;
      }
    };

    const applyKartAutofill = (data) => {
      if (!data) return;
      Object.entries(data).forEach(([key, value]) => {
        if (!kartAutofillFields[key]) return;
        if (value === null || value === undefined) return;
        const normalized = String(value).trim();
        if (!normalized) return;
        const element = kartAutofillFields[key];
        if (element.tagName === 'SELECT') {
          setSelectValue(element, normalized);
        } else {
          element.value = normalized;
        }
      });
    };

    const setKartOpenAiVisibility = (isVisible) => {
      if (!kartOpenAiSettings || !kartOpenAiToggle) return;
      kartOpenAiSettings.classList.toggle('hidden', !isVisible);
      if (kartOpenAiToggleText) {
        kartOpenAiToggleText.textContent = isVisible ? 'ChatGPT設定を閉じる' : 'ChatGPT設定を開く';
      }
      if (kartOpenAiToggleIcon) {
        kartOpenAiToggleIcon.classList.toggle('rotate-180', isVisible);
      }
    };

    const resetKartForm = () => {
      setTab('new');
      setNewPatientEditable();
      Object.entries(kartAutofillFields).forEach(([key, element]) => {
        const defaultValue = kartDefaultValues[key] ?? '';
        if (element.tagName === 'SELECT') {
          setSelectValue(element, defaultValue || element.options?.[0]?.value || '');
        } else {
          element.value = defaultValue;
        }
      });
      if (kartUploadInput) {
        kartUploadInput.value = '';
      }
      if (kartModelInput) {
        kartModelInput.value = kartOpenAiDefaults.model;
      }
      if (kartApiKeyInput) {
        kartApiKeyInput.value = kartOpenAiDefaults.key;
      }
      if (kartPromptInput) {
        kartPromptInput.value = kartOpenAiDefaults.prompt;
      }
      setKartUploadStatus('');
      setKartOpenAiVisibility(false);
    };

    const handleKartUpload = async () => {
      setKartUploadStatus('');
      const files = Array.from(kartUploadInput?.files || []);
      if (!files.length) {
        setKartUploadStatus('ファイルを選択してください。', true);
        return;
      }
      const pdfFiles = files.filter((file) => file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf'));
      if (pdfFiles.length > 1) {
        setKartUploadStatus('PDFは同時に1ファイルのみ選択できます。', true);
        return;
      }
      if (pdfFiles.length === 1 && files.length > 1) {
        setKartUploadStatus('PDFと画像は同時にアップロードできません。', true);
        return;
      }
      const nonImageFiles = files.filter((file) => !file.type.startsWith('image/') && !pdfFiles.includes(file));
      if (nonImageFiles.length > 0) {
        setKartUploadStatus('画像またはPDFファイルを選択してください。', true);
        return;
      }
      const apiKey = kartApiKeyInput?.value?.trim();
      if (!apiKey) {
        setKartUploadStatus('ChatGPT APIシークレットを入力してください。', true);
        return;
      }
      const model = kartModelInput?.value?.trim() || 'gpt-5.2';
      const prompt = kartPromptInput?.value?.trim() || '';
      try {
        if (kartUploadButton) {
          kartUploadButton.disabled = true;
          kartUploadButton.classList.add('opacity-60', 'cursor-not-allowed');
        }
        setKartUploadStatus('解析中...', false);
        const fileNames = files.map((file) => file.name).join(', ');
        const basePrompt = `${prompt}\n\n必ずJSONオブジェクトのみで返してください。値が無い項目はキーを省略してください。キー一覧: ${kartAutofillKeys.join(', ')}`;
        const content = [{ type: 'text', text: `${basePrompt}\n\n[アップロードファイル: ${fileNames}]` }];
        const imageDataUrls = pdfFiles.length
          ? await readPdfAsImages(pdfFiles[0])
          : await Promise.all(files.map((file) => readFileAsDataUrl(file)));
        imageDataUrls.forEach((dataUrl) => {
          content.push({ type: 'image_url', image_url: { url: dataUrl } });
        });

        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model,
            messages: [{ role: 'user', content }],
            temperature: 0.2
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`APIエラー: ${response.status} ${errorText}`);
        }

        const result = await response.json();
        const contentText = result?.choices?.[0]?.message?.content || '';
        const parsed = extractJson(contentText);
        if (!parsed || typeof parsed !== 'object') {
          throw new Error('API応答からJSONを取得できませんでした。');
        }
        applyKartAutofill(parsed);
        setKartUploadStatus('読み取り結果を入力欄へ反映しました。', false);
      } catch (error) {
        setKartUploadStatus(`アップロードエラー: ${error.message}`, true);
      } finally {
        if (kartUploadButton) {
          kartUploadButton.disabled = false;
          kartUploadButton.classList.remove('opacity-60', 'cursor-not-allowed');
        }
      }
    };

    document.body.addEventListener('click', (event) => {
      const action = event.target.closest('[data-action]')?.dataset.action;
      if (!action) return;
      switch (action) {
        case 'login':
          showScreen('screen-loading-post', true);
          setTimeout(() => showScreen('screen-home', true), 800);
          break;
        case 'toggle-login-error':
          toggleElement('login-error');
          break;
        case 'go-home':
        case 'back-home':
          showScreen('screen-home', true);
          break;
        case 'open-menu':
          menuOverlay.classList.remove('hidden');
          break;
        case 'close-menu':
          menuOverlay.classList.add('hidden');
          break;
        case 'go-terms':
          showScreen('screen-terms', true);
          menuOverlay.classList.add('hidden');
          break;
        case 'go-login-info':
          showScreen('screen-login-info', true);
          menuOverlay.classList.add('hidden');
          break;
        case 'toggle-login-info-error':
          toggleElement('login-info-error');
          break;
        case 'login-info-confirm':
          openModal('modal-login-info-confirm');
          break;
        case 'login-info-yes':
          openModal('modal-login-info-done');
          break;
        case 'login-info-no':
          closeModals();
          break;
        case 'login-info-ok':
          closeModals();
          showScreen('screen-home', true);
          break;
        case 'logout-confirm':
          openModal('modal-logout');
          menuOverlay.classList.add('hidden');
          break;
        case 'logout-yes':
          openModal('modal-logout-loading');
          setTimeout(() => {
            closeModals();
            showScreen('screen-login', false);
          }, 800);
          break;
        case 'logout-no':
          closeModals();
          break;
        case 'go-account-search':
          showScreen('screen-account-search', true);
          break;
        case 'go-account-create':
          showScreen('screen-account-create', true);
          break;
        case 'back-account-create':
          showScreen('screen-account-create', true);
          break;
        case 'back-account-search':
          showScreen('screen-account-search', true);
          break;
        case 'go-account-edit':
          showScreen('screen-account-edit', true);
          break;
        case 'back-account-detail':
          showScreen('screen-account-detail', true);
          break;
        case 'account-create-confirm':
          openModal('modal-account-create-confirm');
          break;
        case 'account-create-yes':
          openModal('modal-account-create-done');
          break;
        case 'account-create-no':
          closeModals();
          break;
        case 'account-create-ok':
          closeModals();
          showScreen('screen-account-create', true);
          break;
        case 'account-edit-confirm':
          openModal('modal-account-edit-confirm');
          break;
        case 'account-edit-yes':
          openModal('modal-account-edit-done');
          break;
        case 'account-edit-no':
          closeModals();
          break;
        case 'account-edit-ok':
          closeModals();
          showScreen('screen-account-detail', true);
          break;
        case 'account-delete':
          openModal('modal-account-delete-confirm');
          break;
        case 'account-delete-yes':
          openModal('modal-account-delete-done');
          break;
        case 'account-delete-no':
          closeModals();
          break;
        case 'account-delete-ok':
          closeModals();
          showScreen('screen-account-detail', true);
          break;
        case 'account-revive':
          openModal('modal-account-revive-confirm');
          break;
        case 'account-revive-yes':
          openModal('modal-account-revive-done');
          break;
        case 'account-revive-no':
          closeModals();
          break;
        case 'account-revive-ok':
          closeModals();
          showScreen('screen-account-detail', true);
          break;
        case 'toggle-account-create-error':
          toggleElement('account-create-error');
          break;
        case 'toggle-account-search-error':
          toggleElement('account-search-error');
          break;
        case 'toggle-account-edit-error':
          toggleElement('account-edit-error');
          break;
        case 'go-kart-new':
          showScreen('screen-kart-new', true);
          menuOverlay.classList.add('hidden');
          setTab('new');
          setNewPatientEditable();
          break;
        case 'go-kart-search':
          showScreen('screen-kart-search', true);
          menuOverlay.classList.add('hidden');
          break;
        case 'go-patient-search':
          showScreen('screen-patient-search', true);
          menuOverlay.classList.add('hidden');
          break;
        case 'go-history':
          showScreen('screen-history', true);
          menuOverlay.classList.add('hidden');
          break;
        case 'tab-new':
          setTab('new');
          setNewPatientEditable();
          break;
        case 'tab-master':
          setTab('master');
          break;
        case 'toggle-kart-input-error':
          toggleElement('kart-input-error');
          break;
        case 'toggle-kart-upload-error':
          toggleElement('kart-upload-error');
          break;
        case 'toggle-kart-openai-settings':
          setKartOpenAiVisibility(kartOpenAiSettings?.classList.contains('hidden'));
          break;
        case 'toggle-kart-master-search-error':
          toggleElement('kart-master-search-error');
          break;
        case 'kart-register':
          openModal('modal-kart-register-confirm');
          break;
        case 'kart-reset':
          resetKartForm();
          break;
        case 'kart-register-yes':
          openModal('modal-kart-register-done');
          break;
        case 'kart-register-no':
          closeModals();
          break;
        case 'kart-register-ok':
          closeModals();
          showScreen('screen-kart-new', true);
          break;
        case 'kart-upload':
          handleKartUpload();
          break;
        case 'kart-search':
          break;
        case 'kart-next':
          break;
        case 'kart-master-search':
          break;
        case 'kart-master-next':
          break;
        case 'toggle-kart-search-error':
          toggleElement('kart-search-error');
          break;
        case 'back-kart-search':
          showScreen('screen-kart-search', true);
          break;
        case 'go-kart-edit':
          showScreen('screen-kart-edit', true);
          break;
        case 'back-kart-detail':
          showScreen('screen-kart-detail', true);
          break;
        case 'kart-edit-confirm':
          openModal('modal-kart-edit-confirm');
          break;
        case 'kart-edit-yes':
          openModal('modal-kart-edit-done');
          break;
        case 'kart-edit-no':
          closeModals();
          break;
        case 'kart-edit-ok':
          closeModals();
          showScreen('screen-kart-detail', true);
          break;
        case 'kart-delete':
          openModal('modal-kart-delete-confirm');
          break;
        case 'kart-delete-yes':
          openModal('modal-kart-delete-done');
          break;
        case 'kart-delete-no':
          closeModals();
          break;
        case 'kart-delete-ok':
          closeModals();
          showScreen('screen-kart-detail', true);
          break;
        case 'kart-revive':
          openModal('modal-kart-revive-confirm');
          break;
        case 'kart-revive-yes':
          openModal('modal-kart-revive-done');
          break;
        case 'kart-revive-no':
          closeModals();
          break;
        case 'kart-revive-ok':
          closeModals();
          showScreen('screen-kart-detail', true);
          break;
        case 'go-insurance-download':
          showScreen('screen-insurance-download', true);
          break;
        case 'toggle-download-search-error':
          toggleElement('download-search-error');
          break;
        case 'download-search':
          break;
        case 'download-next':
          break;
        case 'print-confirm-yes':
          openModal('modal-print');
          break;
        case 'print-confirm-no':
          closeModals();
          break;
        case 'print-exec':
          closeModals();
          break;
        case 'print-cancel':
          closeModals();
          break;
        case 'patient-search':
          break;
        case 'patient-next':
          break;
        case 'go-patient-edit':
          showScreen('screen-patient-edit', true);
          break;
        case 'back-patient-search':
          showScreen('screen-patient-search', true);
          break;
        case 'back-patient-detail':
          showScreen('screen-patient-detail', true);
          break;
        case 'toggle-patient-search-error':
          toggleElement('patient-search-error');
          break;
        case 'toggle-patient-edit-error':
          toggleElement('patient-edit-error');
          break;
        case 'patient-edit-confirm':
          openModal('modal-patient-edit-confirm');
          break;
        case 'patient-edit-yes':
          openModal('modal-patient-edit-done');
          break;
        case 'patient-edit-no':
          closeModals();
          break;
        case 'patient-edit-ok':
          closeModals();
          showScreen('screen-patient-detail', true);
          break;
        case 'patient-delete':
          openModal('modal-patient-delete-confirm');
          break;
        case 'patient-delete-yes':
          openModal('modal-patient-delete-done');
          break;
        case 'patient-delete-no':
          closeModals();
          break;
        case 'patient-delete-ok':
          closeModals();
          showScreen('screen-patient-detail', true);
          break;
        case 'patient-revive':
          openModal('modal-patient-revive-confirm');
          break;
        case 'patient-revive-yes':
          openModal('modal-patient-revive-done');
          break;
        case 'patient-revive-no':
          closeModals();
          break;
        case 'patient-revive-ok':
          closeModals();
          showScreen('screen-patient-detail', true);
          break;
        case 'toggle-history-search-error':
          toggleElement('history-search-error');
          break;
        case 'history-search':
          break;
        case 'history-next':
          break;
        case 'history-detail-yes':
          closeModals();
          showScreen('screen-history-detail', true);
          break;
        case 'history-detail-no':
          closeModals();
          break;
        case 'back-history':
          showScreen('screen-history', true);
          break;
        default:
          break;
      }
    });

    const buildRows = (targetId, rows) => {
      const target = document.getElementById(targetId);
      if (!target) return;
      target.innerHTML = rows.join('');
    };

    const accountRows = Array.from({ length: 50 }).map((_, i) => {
      const id = `A${String(1000 + i)}`;
      return `<tr class="hover:bg-slate-50" data-action="open-account-detail">
        <td class="px-4 py-3">${id}</td>
        <td class="px-4 py-3">山田 ${i + 1}</td>
        <td class="px-4 py-3">${i % 3 === 0 ? '管理者' : i % 3 === 1 ? '入力者' : '閲覧者'}</td>
        <td class="px-4 py-3">${i % 7 === 0 ? '削除済み' : '有効'}</td>
        <td class="px-4 py-3">2024/05/${String((i % 28) + 1).padStart(2, '0')}</td>
        <td class="px-4 py-3">2024/07/${String((i % 28) + 1).padStart(2, '0')}</td>
      </tr>`;
    });
    buildRows('account-table', accountRows);

    const kartRows = Array.from({ length: 50 }).map((_, i) => {
      const id = `K-2024${String((i % 12) + 1).padStart(2, '0')}-${String(i + 1).padStart(3, '0')}`;
      return `<tr class="hover:bg-slate-50" data-action="open-kart-detail">
        <td class="px-4 py-3">${id}</td>
        <td class="px-4 py-3">P-${1000 + i}</td>
        <td class="px-4 py-3">患者 ${i + 1}</td>
        <td class="px-4 py-3">${i % 2 === 0 ? '富士保険' : '虹ヶ丘保険'}</td>
        <td class="px-4 py-3">${i % 3 === 0 ? '外傷' : i % 3 === 1 ? 'リハビリ' : '通院'}</td>
        <td class="px-4 py-3">${i % 9 === 0 ? '削除済み' : '有効'}</td>
        <td class="px-4 py-3">2024/06/${String((i % 28) + 1).padStart(2, '0')}</td>
        <td class="px-4 py-3">2024/07/${String((i % 28) + 1).padStart(2, '0')}</td>
      </tr>`;
    });
    buildRows('kart-table', kartRows);

    const patientRows = Array.from({ length: 50 }).map((_, i) => {
      return `<tr class="hover:bg-slate-50" data-action="open-patient-detail">
        <td class="px-4 py-3">P-${1200 + i}</td>
        <td class="px-4 py-3">患者名 ${i + 1}</td>
        <td class="px-4 py-3">${i % 10 === 0 ? '削除済み' : '有効'}</td>
        <td class="px-4 py-3">2024/03/${String((i % 28) + 1).padStart(2, '0')}</td>
        <td class="px-4 py-3">2024/07/${String((i % 28) + 1).padStart(2, '0')}</td>
      </tr>`;
    });
    buildRows('patient-table', patientRows);

    const masterRows = Array.from({ length: 50 }).map((_, i) => {
      return `<tr class="hover:bg-slate-50" data-action="select-master">
        <td class="px-4 py-3">P-${5000 + i}</td>
        <td class="px-4 py-3">患者 ${i + 1}</td>
        <td class="px-4 py-3">${i % 6 === 0 ? '削除済み' : '有効'}</td>
      </tr>`;
    });
    buildRows('kart-master-table', masterRows);

    const downloadRows = Array.from({ length: 50 }).map((_, i) => {
      return `<tr class="hover:bg-slate-50" data-action="open-print-confirm">
        <td class="px-4 py-3">${i % 2 === 0 ? '富士保険' : '虹ヶ丘保険'}</td>
        <td class="px-4 py-3">様式 ${i + 1}</td>
        <td class="px-4 py-3">${i % 3 === 0 ? '外傷' : i % 3 === 1 ? '通院' : '手術'}</td>
      </tr>`;
    });
    buildRows('download-table', downloadRows);

    const historyRows = Array.from({ length: 50 }).map((_, i) => {
      return `<tr class="hover:bg-slate-50" data-action="open-history-detail">
        <td class="px-4 py-3">2024/07/${String((i % 28) + 1).padStart(2, '0')} 10:${String(i % 60).padStart(2, '0')}</td>
        <td class="px-4 py-3">担当者 ${i + 1}</td>
        <td class="px-4 py-3">A${1000 + i}</td>
        <td class="px-4 py-3">${i % 4 === 0 ? '作成' : i % 4 === 1 ? '編集' : i % 4 === 2 ? '削除' : 'ダウンロード'}</td>
        <td class="px-4 py-3">${i % 3 === 0 ? 'カルテ' : i % 3 === 1 ? '患者' : 'アカウント'}</td>
        <td class="px-4 py-3">ID-${100 + i}</td>
        <td class="px-4 py-3">操作概要 ${i + 1}</td>
      </tr>`;
    });
    buildRows('history-table', historyRows);

    document.body.addEventListener('click', (event) => {
      const rowAction = event.target.closest('tr')?.dataset.action;
      if (!rowAction) return;
      switch (rowAction) {
        case 'open-account-detail':
          showScreen('screen-account-detail', true);
          break;
        case 'open-kart-detail':
          showScreen('screen-kart-detail', true);
          break;
        case 'open-patient-detail':
          showScreen('screen-patient-detail', true);
          break;
        case 'open-print-confirm':
          openModal('modal-print-confirm');
          break;
        case 'open-history-detail':
          openModal('modal-history-detail');
          break;
        case 'select-master':
          document.getElementById('kart-patient-id').value = 'P-1201';
          document.getElementById('kart-patient-name').value = '佐藤 遥';
          document.getElementById('kart-patient-id').setAttribute('disabled', 'true');
          document.getElementById('kart-patient-name').setAttribute('disabled', 'true');
          document.getElementById('kart-patient-id').classList.add('bg-slate-100');
          document.getElementById('kart-patient-name').classList.add('bg-slate-100');
          break;
        default:
          break;
      }
    });

    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;

    const blobs = Array.from({ length: 6 }).map((_, i) => ({
      x: Math.random() * width,
      y: Math.random() * height,
      radius: 220 + i * 35,
      dx: (Math.random() - 0.5) * 1.8,
      dy: (Math.random() - 0.5) * 1.8,
      color: `rgba(${80 + i * 20}, ${120 + i * 10}, 255, 0.25)`
    }));

    const resizeCanvas = () => {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    };

    window.addEventListener('resize', resizeCanvas);

    const animate = () => {
      ctx.clearRect(0, 0, width, height);
      ctx.fillStyle = '#f8fafc';
      ctx.fillRect(0, 0, width, height);
      blobs.forEach(blob => {
        blob.x += blob.dx;
        blob.y += blob.dy;
        if (blob.x < -blob.radius || blob.x > width + blob.radius) blob.dx *= -1;
        if (blob.y < -blob.radius || blob.y > height + blob.radius) blob.dy *= -1;
        const gradient = ctx.createRadialGradient(blob.x, blob.y, 0, blob.x, blob.y, blob.radius);
        gradient.addColorStop(0, blob.color);
        gradient.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(blob.x, blob.y, blob.radius, 0, Math.PI * 2);
        ctx.fill();
      });
      requestAnimationFrame(animate);
    };
    animate();

    lucide.createIcons();

    setTimeout(() => {
      showScreen('screen-login', false);
    }, 900);
  </script>
</body>
</html>
